---
- hosts: localhost
  gather_facts: true
  tasks:
    - name: Retrieve a repository from a distant location and make it available locally
      ansible.scm.git_retrieve:
        origin:
          url: https://github.com/rlopez133/demos.git
      register: repository

    - name: Create rocketchat Namespace
      kubernetes.core.k8s:
        kind: Namespace
        name: rocketchat
        state: present

    - name: Apply Kubernetes Resources
      kubernetes.core.k8s:
        src: "{{ repository.path }}/backstage-aap/rocketchat/{{ item }}"
        namespace: rocketchat
      loop:
        - 1-pvc.yml
        - 2-deployment-mongo.yml
        - 3-service-mongo.yml
        - 4-deployment-rocket.yml
        - 5-service-rocket.yml
        - 6-route.yml

    - name: Pause for a short duration after each resource application
      pause:
        seconds: 10
      loop:
        - 1-pvc.yml
        - 2-deployment-mongo.yml
        - 3-service-mongo.yml
        - 4-deployment-rocket.yml
        - 5-service-rocket.yml
        - 6-route.yml
